---
title: "Africa Bivariate Maps"
author: "Taylor Lockmann, Chris Kracha"
date: "2022-07-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load in packages
library(tidyverse)
library(terra)
library(raster)

# Enter google filestream path including "HWC_data"
HWC_data <- "G:/.shortcut-targets-by-id/1YB-Hz3L-kWyiZMg2UM89GQkvqXyZUW1H/HWC_data"
```


# BASELINE/HISTORIC MAPPING

## CROPLAND

### Read in files
```{r}
# Read in the baseline land use and SDM
sdm <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/1981_2010/afel_historic_sdm.tif"))
lu <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/global_LULC_2015.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```

#### Re-project SDM to equal-area
```{r}
sdm_reproj_af <- sdm %>% 
  project(crs(lu))

plot(sdm_reproj_af)
```

#### Reclassify SDM
```{r}
baseline_sdm <- sdm_reproj_af
baseline_sdm[baseline_sdm >= 0 & baseline_sdm < 0.33] <- 10
baseline_sdm[baseline_sdm >= 0.33 & baseline_sdm < 0.66] <- 20
baseline_sdm[baseline_sdm >=0.66 & baseline_sdm <= 1] <- 30

plot(baseline_sdm)
```

### Land Use

#### Crop land use to africa
```{r}
lu_af <- crop(lu, sdm_reproj_af)
```

#### Reclassify baseline land use to cropland binary
We want cropland (category 5) to be 1, everything else to be 0
```{r}
baseline_cropland <- lu_af
baseline_cropland[baseline_cropland != 5] <- 0
baseline_cropland[baseline_cropland == 5] <- 1
plot(baseline_cropland)
```

#### Aggregate cropland binary
```{r}
baseline_cropland_agg <- terra::aggregate(x = baseline_cropland, fact = 10, fun = mean, na.rm = TRUE)

plot(baseline_cropland_agg)
```

#### Reclassify aggregated agriculture into 3 categories

```{r}
# Categories used to visualize baseline maps
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

base_cropland_factor <- baseline_cropland_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(base_cropland_factor)
```

### Add SDM and cropland

#### Make the SDM have the same resolution as the cropland
```{r}
baseline_sdm_resamp <- terra::resample(baseline_sdm, 
                                       base_cropland_factor, 
                                       method = "near")

plot(baseline_sdm_resamp)
```

#### Add the two layers together
```{r}
baseline_bivariate_afrotropics <- as.factor(baseline_sdm_resamp 
                                + base_cropland_factor)

blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000") # Most colorblind friendly scale

plot(baseline_bivariate_afrotropics, main = "Baseline SDM and Cropland", type = "classes", col = blueOrangeScale)
```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(baseline_bivariate_afrotropics, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_baseline.tif"), overwrite = TRUE)
```



## URBAN

#### Reclassify values of the baseline year for urban
We want urban (category 5) to be 1, everything else to be 0
```{r}
baseline_urban <- lu_af
baseline_urban[baseline_urban != 6] <- 0
baseline_urban[baseline_urban == 6] <- 1
plot(baseline_urban)
```

#### Aggregate urban baseline
```{r}
baseline_urban_agg <- terra::aggregate(x = baseline_urban, fact = 10, fun = mean, na.rm = TRUE)

plot(baseline_urban_agg)
```

#### Reclassify to 3 categories
```{r}
# Categories used to visualize baseline maps
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

base_urban_factor <- baseline_urban_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(base_urban_factor)
```

#### Resample SDM to aggregated urban resolution
```{r}
baseline_sdm_resamp_urb <- terra::resample(baseline_sdm, 
                                       base_urban_factor, 
                                       method = "near")

plot(baseline_sdm_resamp_urb)
```

#### Add the two layers together
```{r}
baseline_bivariate_afrotropics_urban <- as.factor(baseline_sdm_resamp_urb + base_urban_factor)

blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(baseline_bivariate_afrotropics_urban, main = "Baseline SDM and Urban", type = "classes", col = blueOrangeScale)

```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(baseline_bivariate_afrotropics_urban, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_urban_bivariate_baseline.tif"), overwrite = TRUE)
```


# FUTURE PROJECTIONS

## Year: 2011-2040, Scenario: SSP1/RCP2.6, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
library(tidyverse)
library(terra)
library(raster)
```

#### Read in land use and SDM
```{r}
sdm_126_2020 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2011_2040/370/afel_gfdl_2011_2040_370_sdm_correctbio3.tif"))
lu_126_2020 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2025.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_126_2020) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_126_2020)
plot(lu_126_2020)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_126_2020_reproj_af <- sdm_126_2020 %>% 
  project(crs(lu_126_2020), method = "near")

plot(sdm_126_2020_reproj_af)
```

#### Reclassify values of the SDM Change map
```{r}
sdm_126_2020_reclass <- sdm_126_2020_reproj_af
sdm_126_2020_reclass[sdm_126_2020_reclass >= 0 & sdm_126_2020_reclass < 0.33] <- 10
sdm_126_2020_reclass[sdm_126_2020_reclass >= 0.33 & sdm_126_2020_reclass < 0.66] <- 20
sdm_126_2020_reclass[sdm_126_2020_reclass >=0.66 & sdm_126_2020_reclass <= 1] <- 30

plot(sdm_126_2020_reclass)
```

### Land Use

#### Crop land use to africa
```{r}
lu_126_2020_af <- crop(lu_126_2020, sdm_126_2020_reproj_af)
plot(lu_126_2020_af)
```

#### Reclassify values of the year 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_126_2020 <- lu_126_2020_af
cropland_126_2020[cropland_126_2020 != 5] <- 0
cropland_126_2020[cropland_126_2020 == 5] <- 1
plot(cropland_126_2020)
```

#### Aggregate cropland

```{r}
cropland_126_2020_agg <- terra::aggregate(x = cropland_126_2020, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2020_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2020_factor <- cropland_126_2020_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2020_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_126_2020_resamp <- resample(sdm_126_2020_reclass, cropland_126_2020_factor, method = "near")

plot(as.factor(sdm_126_2020_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2025)
```{r}
af_bivar_126_2020 <- as.factor(sdm_126_2020_resamp + cropland_126_2020_factor)

```

### Map and export final raster

#### Map with colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_126_2020, main = "SDM and Cropland in 2025
     SSP1 RCP2.6", type = "classes", col = blueOrangeScale)
```


#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_126_2020, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_126_2020.tif"), overwrite = TRUE)
```





## Year: 2011-2040, Scenario: SSP3/RCP7.0, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
library(tidyverse)
library(terra)
library(raster)
```

#### Read in land use and SDM
```{r}
sdm_370_2020 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2011_2040/370/afel_gfdl_2011_2040_370_sdm_correctbio3.tif"))
lu_370_2020 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP3_RCP70/global_SSP3_RCP70_2025.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_370_2020) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_370_2020)
plot(lu_370_2020)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_370_2020_reproj_af <- sdm_370_2020 %>% 
  project(crs(lu_370_2020), method = "near")

plot(sdm_370_2020_reproj_af)
```

#### Reclassify values of the SDM map
```{r}
sdm_370_2020_reclass <- sdm_370_2020_reproj_af
sdm_370_2020_reclass[sdm_370_2020_reclass >= 0 & sdm_370_2020_reclass < 0.33] <- 10
sdm_370_2020_reclass[sdm_370_2020_reclass >= 0.33 & sdm_370_2020_reclass < 0.66] <- 20
sdm_370_2020_reclass[sdm_370_2020_reclass >=0.66 & sdm_370_2020_reclass <= 1] <- 30

plot(sdm_370_2020_reclass)
```

### Land Use

#### Crop land use to africa
```{r}
lu_370_2020_af <- crop(lu_370_2020, sdm_370_2020_reclass)
plot(lu_370_2020_af)
```

#### Reclassify values of the year 2025 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_370_2020 <- lu_370_2020_af
cropland_370_2020[cropland_370_2020 != 5] <- 0
cropland_370_2020[cropland_370_2020 == 5] <- 1
plot(cropland_370_2020)
```

#### Aggregate cropland

```{r}
cropland_370_2020_agg <- terra::aggregate(x = cropland_370_2020, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_370_2020_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_370_2020_factor <- cropland_370_2020_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_370_2020_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_370_2020_resamp <- resample(sdm_370_2020_reclass, cropland_370_2020_factor, method = "near")

plot(as.factor(sdm_370_2020_resamp))
```

#### Raster math - Cropland vs SDM (SSP3/RCP7.0, 2025)
```{r}
af_bivar_370_2020 <- as.factor(sdm_370_2020_resamp + cropland_370_2020_factor)
```

### Map and export final raster

#### Map with colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_370_2020, main = "SDM and Cropland in 2025
     SSP3 RCP7.0", type = "classes", col = blueOrangeScale)
```


#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_370_2020, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_370_2020.tif"), overwrite = TRUE)
```

## Year: 2011-2040, Scenario: SSP5/RCP8.5, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load packages
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2050 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2011_2040/585/afel_gfdl_2011_2040_585_sdm_correctbio3.tif"))
lu_585_2050 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2025.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_585_2050) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_585_2050)
plot(lu_585_2050)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_585_2050_reproj_af <- sdm_585_2050 %>% 
  project(crs(lu_585_2050), method = "near")

plot(sdm_585_2050_reproj_af)
```

#### Reclassify values of the SDM Change map
```{r}
sdm_585_2050_reclass <- sdm_585_2050_reproj_af
sdm_585_2050_reclass[sdm_585_2050_reclass >= 0 & sdm_585_2050_reclass < 0.33] <- 10
sdm_585_2050_reclass[sdm_585_2050_reclass >= 0.33 & sdm_585_2050_reclass < 0.66] <- 20
sdm_585_2050_reclass[sdm_585_2050_reclass >=0.66 & sdm_585_2050_reclass <= 1] <- 30

plot(sdm_585_2050_reclass)
```

### Land Use

#### Crop land use to africa
```{r}
lu_585_2050_af <- crop(lu_585_2050, sdm_585_2050_reproj_af)
plot(lu_585_2050_af)
```

#### Reclassify values of the year 2085 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_585_2050 <- lu_585_2050_af
cropland_585_2050[cropland_585_2050 != 5] <- 0
cropland_585_2050[cropland_585_2050 == 5] <- 1
plot(cropland_585_2050)
```

#### Aggregate cropland

```{r}
cropland_585_2050_agg <- terra::aggregate(x = cropland_585_2050, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2050_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0.1,0),
                        c(0.1, 0.5 ,1),
                        c(0.9,1,2))

cropland_585_2050_factor <- cropland_585_2050_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2050_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_585_2050_resamp <- resample(sdm_585_2050_reclass, cropland_585_2050_factor, method = "near")

plot(as.factor(sdm_585_2050_resamp))
```

#### Raster math - Cropland vs SDM change (SSP5/RCP8.5, 2025)
```{r}
af_bivar_585_2050 <- as.factor(sdm_585_2050_resamp + cropland_585_2050_factor)
```

### Map and export final raster

#### Map with Colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_585_2050, main = "SDM and Cropland in 2025
     SSP5 RCP8.5", type = "classes", col = blueOrangeScale)
```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_585_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_585_2050.tif"), overwrite = TRUE)
```



## Year: 2041-2070, Scenario: SSP1/RCP2.6, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
library(tidyverse)
library(terra)
library(raster)
```

#### Read in land use and SDM
```{r}
sdm_126_2050 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2041_2070/126/afel_gfdl_2041_2070_126_sdm_correctbio3.tif"))
lu_126_2050 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2055.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_126_2050) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_126_2050)
plot(lu_126_2050)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_126_2050_reproj_af <- sdm_126_2050 %>% 
  project(crs(lu_126_2050), method = "near")

plot(sdm_126_2050_reproj_af)
```

#### Reclassify values of the SDM Change map
```{r}
sdm_126_2050_reclass <- sdm_126_2050_reproj_af
sdm_126_2050_reclass[sdm_126_2050_reclass >= 0 & sdm_126_2050_reclass < 0.33] <- 10
sdm_126_2050_reclass[sdm_126_2050_reclass >= 0.33 & sdm_126_2050_reclass < 0.66] <- 20
sdm_126_2050_reclass[sdm_126_2050_reclass >=0.66 & sdm_126_2050_reclass <= 1] <- 30

plot(sdm_126_2050_reclass)
```

### Land Use

#### Crop land use to africa
```{r}
lu_126_2050_af <- crop(lu_126_2050, sdm_126_2050_reproj_af)
plot(lu_126_2050_af)
```

#### Reclassify values of the year 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_126_2050 <- lu_126_2050_af
cropland_126_2050[cropland_126_2050 != 5] <- 0
cropland_126_2050[cropland_126_2050 == 5] <- 1
plot(cropland_126_2050)
```

#### Aggregate cropland

```{r}
cropland_126_2050_agg <- terra::aggregate(x = cropland_126_2050, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2050_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2050_factor <- cropland_126_2050_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2050_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_126_2050_resamp <- resample(sdm_126_2050_reclass, cropland_126_2050_factor, method = "near")

plot(as.factor(sdm_126_2050_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2055)
```{r}
af_bivar_126_2050 <- as.factor(sdm_126_2050_resamp + cropland_126_2050_factor)

```

### Map and export final raster

#### Map with colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_126_2050, main = "SDM and Cropland in 2055
     SSP1 RCP2.6", type = "classes", col = blueOrangeScale)
```


#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_126_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_126_2050.tif"), overwrite = TRUE)
```





## Year: 2041-2070, Scenario: SSP3/RCP7.0, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
library(tidyverse)
library(terra)
library(raster)
```

#### Read in land use and SDM
```{r}
sdm_370_2050 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2041_2070/370/afel_gfdl_2041_2070_370_sdm_correctbio3.tif"))
lu_370_2050 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP3_RCP70/global_SSP3_RCP70_2055.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_370_2050) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_370_2050)
plot(lu_370_2050)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_370_2050_reproj_af <- sdm_370_2050 %>% 
  project(crs(lu_370_2050), method = "near")

plot(sdm_370_2050_reproj_af)
```

#### Reclassify values of the SDM map
```{r}
sdm_370_2050_reclass <- sdm_370_2050_reproj_af
sdm_370_2050_reclass[sdm_370_2050_reclass >= 0 & sdm_370_2050_reclass < 0.33] <- 10
sdm_370_2050_reclass[sdm_370_2050_reclass >= 0.33 & sdm_370_2050_reclass < 0.66] <- 20
sdm_370_2050_reclass[sdm_370_2050_reclass >=0.66 & sdm_370_2050_reclass <= 1] <- 30

plot(sdm_370_2050_reclass)
```

### Land Use

#### Crop land use to africa
```{r}
lu_370_2050_af <- crop(lu_370_2050, sdm_370_2050_reproj_af)
plot(lu_370_2050_af)
```

#### Reclassify values of the year 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_370_2050 <- lu_370_2050_af
cropland_370_2050[cropland_370_2050 != 5] <- 0
cropland_370_2050[cropland_370_2050 == 5] <- 1
plot(cropland_370_2050)
```

#### Aggregate cropland

```{r}
cropland_370_2050_agg <- terra::aggregate(x = cropland_370_2050, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_370_2050_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_370_2050_factor <- cropland_370_2050_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_370_2050_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_370_2050_resamp <- resample(sdm_370_2050_reclass, cropland_370_2050_factor, method = "near")

plot(as.factor(sdm_370_2050_resamp))
```

#### Raster math - Cropland vs SDM (SSP3/RCP7.0, 2055)
```{r}
af_bivar_370_2050 <- as.factor(sdm_370_2050_resamp + cropland_370_2050_factor)
```

### Map and export final raster

#### Map with colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_370_2050, main = "SDM and Cropland in 2055
     SSP3 RCP7.0", type = "classes", col = blueOrangeScale)
```


#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_370_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_370_2050.tif"), overwrite = TRUE)
```

## Year: 2041-2070, Scenario: SSP5/RCP8.5, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load packages
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2050 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2041_2070/585/afel_gfdl_2041_2070_585_sdm_correctbio3.tif"))
lu_585_2050 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2055.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_585_2050) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_585_2050)
plot(lu_585_2050)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_585_2050_reproj_af <- sdm_585_2050 %>% 
  project(crs(lu_585_2050), method = "near")

plot(sdm_585_2050_reproj_af)
```

#### Reclassify values of the SDM Change map
```{r}
sdm_585_2050_reclass <- sdm_585_2050_reproj_af
sdm_585_2050_reclass[sdm_585_2050_reclass >= 0 & sdm_585_2050_reclass < 0.33] <- 10
sdm_585_2050_reclass[sdm_585_2050_reclass >= 0.33 & sdm_585_2050_reclass < 0.66] <- 20
sdm_585_2050_reclass[sdm_585_2050_reclass >=0.66 & sdm_585_2050_reclass <= 1] <- 30

plot(sdm_585_2050_reclass)
```

### Land Use

#### Crop land use to africa
```{r}
lu_585_2050_af <- crop(lu_585_2050, sdm_585_2050_reproj_af)
plot(lu_585_2050_af)
```

#### Reclassify values of the year 2085 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_585_2050 <- lu_585_2050_af
cropland_585_2050[cropland_585_2050 != 5] <- 0
cropland_585_2050[cropland_585_2050 == 5] <- 1
plot(cropland_585_2050)
```

#### Aggregate cropland

```{r}
cropland_585_2050_agg <- terra::aggregate(x = cropland_585_2050, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2050_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0.1,0),
                        c(0.1, 0.5 ,1),
                        c(0.9,1,2))

cropland_585_2050_factor <- cropland_585_2050_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2050_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_585_2050_resamp <- resample(sdm_585_2050_reclass, cropland_585_2050_factor, method = "near")

plot(as.factor(sdm_585_2050_resamp))
```

#### Raster math - Cropland vs SDM change (SSP5/RCP8.5, 2055)
```{r}
af_bivar_585_2050 <- as.factor(sdm_585_2050_resamp + cropland_585_2050_factor)
```

### Map and export final raster

#### Map with Colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_585_2050, main = "SDM and Cropland in 2055
     SSP5 RCP8.5", type = "classes", col = blueOrangeScale)
```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_585_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_585_2050.tif"), overwrite = TRUE)
```



## Year: 2071-2100, Scenario: SSP1/RCP2.6, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
library(tidyverse)
library(terra)
library(raster)
```

#### Read in land use and SDM
```{r}
sdm_126_2080 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2071_2100/126/afel_gfdl_2071_2100_126_10p_sdm_correctbio3.tif"))
lu_126_2080 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2085.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_126_2080) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_126_2080)
plot(lu_126_2080)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_126_2080_reproj_af <- sdm_126_2080 %>% 
  project(crs(lu_126_2080), method = "near")

plot(sdm_126_2080_reproj_af)
```

#### Reclassify values of the SDM Change map
```{r}
sdm_126_2080_reclass <- sdm_126_2080_reproj_af
sdm_126_2080_reclass[sdm_126_2080_reclass >= 0 & sdm_126_2080_reclass < 0.33] <- 10
sdm_126_2080_reclass[sdm_126_2080_reclass >= 0.33 & sdm_126_2080_reclass < 0.66] <- 20
sdm_126_2080_reclass[sdm_126_2080_reclass >=0.66 & sdm_126_2080_reclass <= 1] <- 30

plot(sdm_126_2080_reclass)
```

### Land Use

#### Crop land use to africa
```{r}
lu_126_2080_af <- crop(lu_126_2080, sdm_126_2080_reproj_af)
plot(lu_126_2080_af)
```

#### Reclassify values of the year 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_126_2080 <- lu_126_2080_af
cropland_126_2080[cropland_126_2080 != 5] <- 0
cropland_126_2080[cropland_126_2080 == 5] <- 1
plot(cropland_126_2080)
```

#### Aggregate cropland

```{r}
cropland_126_2080_agg <- terra::aggregate(x = cropland_126_2080, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2080_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2080_factor <- cropland_126_2080_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2080_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_126_2080_resamp <- resample(sdm_126_2080_reclass, cropland_126_2080_factor, method = "near")

plot(as.factor(sdm_126_2080_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2085)
```{r}
af_bivar_126_2080 <- as.factor(sdm_126_2080_resamp + cropland_126_2080_factor)

```

### Map and export final raster

#### Map with colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_126_2080, main = "SDM and Cropland in 2085
     SSP1 RCP2.6", type = "classes", col = blueOrangeScale)
```


#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_126_2080, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_126_2080.tif"), overwrite = TRUE)
```





## Year: 2071-2100, Scenario: SSP3/RCP7.0, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
library(tidyverse)
library(terra)
library(raster)
```

#### Read in land use and SDM
```{r}
sdm_370_2080 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2071_2100/370/afel_gfdl_2071_2100_370_10p_sdm_correctbio3.tif"))
lu_370_2080 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP3_RCP70/global_SSP3_RCP70_2085.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_370_2080) <- c(-25.3584728410000011,
                        77.5998600799999849,
                       -40.4084724209999990,
                        26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_370_2080)
plot(lu_370_2080)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_370_2080_reproj_af <- sdm_370_2080 %>% 
  project(crs(lu_370_2080), method = "near")

plot(sdm_370_2080_reproj_af)
```

#### Reclassify values of the SDM Change map
```{r}
sdm_370_2080_reclass <- sdm_370_2080_reproj_af
sdm_370_2080_reclass[sdm_370_2080_reclass >= 0 & sdm_370_2080_reclass < 0.33] <- 10
sdm_370_2080_reclass[sdm_370_2080_reclass >= 0.33 & sdm_370_2080_reclass < 0.66] <- 20
sdm_370_2080_reclass[sdm_370_2080_reclass >=0.66 & sdm_370_2080_reclass <= 1] <- 30

plot(sdm_370_2080_reclass)
```

### Land Use

#### Crop land use to Africa
```{r}
lu_370_2080_af <- crop(lu_370_2080, sdm_370_2080_reproj_af)
plot(lu_370_2080_af)
```

#### Reclassify values of the year 2085 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_370_2080 <- lu_370_2080_af
cropland_370_2080[cropland_370_2080 != 5] <- 0
cropland_370_2080[cropland_370_2080 == 5] <- 1
plot(cropland_370_2080)
```

#### Aggregate cropland

```{r}
cropland_370_2080_agg <- terra::aggregate(x = cropland_370_2080, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_370_2080_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.75,1),
                        c(0.75,1,2))

cropland_370_2080_factor <- cropland_370_2080_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_370_2080_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_370_2080_resamp <- resample(sdm_370_2080_reclass, cropland_370_2080_factor, method = "near")

plot(as.factor(sdm_370_2080_resamp))
```

#### Raster math - Cropland and SDM (SSP3/RCP7.0, 2085)
```{r}
af_bivar_370_2080 <- as.factor(sdm_370_2080_resamp + cropland_370_2080_factor)

```

### Map and export final raster

#### Map with colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_370_2080, main = "SDM and Cropland in 2085
     SSP3 RCP7.0", type = "classes", col = blueOrangeScale)
```


#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_370_2080, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_370_2080.tif"), overwrite = TRUE)
```



## Year: 2071-2100, Scenario: SSP5/RCP8.5, GCM: GFDL Static

### Setup and read PROJECTED land use and SDM

#### Load packages
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2080 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2071_2100/585/afel_gfdl_2071_2100_585_10p_sdm_correctbio3.tif"))
lu_585_2080 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2085.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_585_2080) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_585_2080)
plot(lu_585_2080)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_585_2080_reproj_af <- sdm_585_2080 %>% 
  project(crs(lu_585_2080), method = "near")

plot(sdm_585_2080_reproj_af)
```

#### Reclassify values of the SDM Change map
```{r}
sdm_585_2080_reclass <- sdm_585_2080_reproj_af
sdm_585_2080_reclass[sdm_585_2080_reclass >= 0 & sdm_585_2080_reclass < 0.33] <- 10
sdm_585_2080_reclass[sdm_585_2080_reclass >= 0.33 & sdm_585_2080_reclass < 0.66] <- 20
sdm_585_2080_reclass[sdm_585_2080_reclass >=0.66 & sdm_585_2080_reclass <= 1] <- 30

plot(sdm_585_2080_reclass)
```

### Land Use

#### Crop land use to africa
```{r}
lu_585_2080_af <- crop(lu_585_2080, sdm_585_2080_reproj_af)
plot(lu_585_2080_af)
```

#### Reclassify values of the year 2085 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_585_2080 <- lu_585_2080_af
cropland_585_2080[cropland_585_2080 != 5] <- 0
cropland_585_2080[cropland_585_2080 == 5] <- 1
plot(cropland_585_2080)
```

#### Aggregate cropland

```{r}
cropland_585_2080_agg <- terra::aggregate(x = cropland_585_2080, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2080_agg)
```
#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0.1,0),
                        c(0.1, 0.5 ,1),
                        c(0.9,1,2))

cropland_585_2080_factor <- cropland_585_2080_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2080_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_585_2080_resamp <- resample(sdm_585_2080_reclass, cropland_585_2080_factor, method = "near")

plot(as.factor(sdm_585_2080_resamp))
```

#### Raster math - Cropland and SDM (SSP5/RCP8.5, 2085)
```{r}
af_bivar_585_2080 <- as.factor(sdm_585_2080_resamp + cropland_585_2080_factor)
```

### Map and export final raster

#### Map with Colors
```{r}
blueOrangeScale <- c("#f3f3f3", "#f3e6b3", "#f3b300", "#b4d3e1", "#b3b3b3", "#b36600", "#509dc2", "#376387", "#000000")

plot(af_bivar_585_2080, main = "SDM and Cropland in 2085
     SSP5 RCP8.5", type = "classes", col = blueOrangeScale)
```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_bivar_585_2080, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_bivariate_585_2080.tif"), overwrite = TRUE)
```


# CHANGE FROM PRESENT

## Year: 2011-2040, Scenario: SSP1/RCP2.6, GCM: GFDL Change

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_126_2020 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2011_2040/126/change_maps/afel_change_2011_2040_126_gfdl.tif"))
lu_126_2020 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2025.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_126_2020) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
```{r}
plot(sdm_126_2020)
plot(lu_126_2020)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_126_2020_reproj_as <- sdm_126_2020 %>% 
  project(crs(lu_126_2020), method = "near")

plot(sdm_126_2020_reproj_as)
```

#### Reclassify values of the SDM Change map
In original:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
Now:
Same, except reclassify 2 (no change, not suitable) as NA
```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_126_2020_reclass <- sdm_126_2020_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_126_2020_reclass))
```

### Land Use

#### Crop land use to africa
```{r}
lu_126_2020_af <- crop(lu_126_2020, sdm_126_2020_reproj_as)
plot(lu_126_2020_af)
```

#### Reclassify values of the year 2025 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_126_2020 <- lu_126_2020_af
cropland_126_2020[cropland_126_2020 != 5] <- 0
cropland_126_2020[cropland_126_2020 == 5] <- 1
plot(cropland_126_2020)
```

#### Aggregate cropland

```{r}
cropland_126_2020_agg <- terra::aggregate(x = cropland_126_2020, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2020_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2020_factor <- cropland_126_2020_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2020_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution
```{r}
sdm_126_2020_resamp <- resample(sdm_126_2020_reclass, cropland_126_2020_factor, method = "near")

plot(as.factor(sdm_126_2020_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2025)
```{r}
af_sdm_change_ag_126_2020 <- as.factor(sdm_126_2020_resamp + cropland_126_2020_factor)
```

### Map and export final raster

####Map with colors
```{r}
sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(af_sdm_change_ag_126_2020, main = "SDM and Cropland in 2025
     SSP1 RCP2.6", type = "classes", col = sdmRYGscale)

```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_sdm_change_ag_126_2020, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_sdm_change_ag_126_2020.tif"), overwrite = TRUE)
```

## Year: 2011-2040, Scenario: SSP5/RCP8.5, GCM: GFDL Change

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2020 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2011_2040/585/change_maps/afel_change_2011_2040_585_gfdl.tif"))
lu_585_2020 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2025.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_585_2020) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
```{r}
plot(sdm_585_2020)
plot(lu_585_2020)
```
#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_585_2020_reproj_as <- sdm_585_2020 %>% 
  project(crs(lu_585_2020), method = "near")

plot(sdm_585_2020_reproj_as)
```

#### Reclassify values of the SDM Change map
In original:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
Now:
Same, except reclassify 2 (no change, not suitable) as NA
```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_585_2020_reclass <- sdm_585_2020_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_585_2020_reclass))
```

### Land Use

#### Crop land use to africa
```{r}
lu_585_2020_af <- crop(lu_585_2020, sdm_585_2020_reproj_as)
plot(lu_585_2020_af)
```

#### Reclassify values of the year 2025 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_585_2020 <- lu_585_2020_af
cropland_585_2020[cropland_585_2020 != 5] <- 0
cropland_585_2020[cropland_585_2020 == 5] <- 1
plot(cropland_585_2020)
```

#### Aggregate cropland
```{r}
cropland_585_2020_agg <- terra::aggregate(x = cropland_585_2020, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2020_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_585_2020_factor <- cropland_585_2020_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2020_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution
```{r}
sdm_585_2020_resamp <- resample(sdm_585_2020_reclass, cropland_585_2020_factor, method = "near")

plot(as.factor(sdm_585_2020_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP5/RCP8.5, 2025)
```{r}
af_sdm_change_ag_585_2020 <- as.factor(sdm_585_2020_resamp + cropland_585_2020_factor)
```

### Map and export final raster

#### Map with colors
```{r}
sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(af_sdm_change_ag_585_2020, main = "SDM Change and Cropland in 2025 
     SSP5 RCP8.5", type = "classes", col = sdmRYGscale)
```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_sdm_change_ag_585_2020, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_sdm_change_ag_585_2020.tif"), overwrite = TRUE)
```




## Year: 2041-2070, Scenario: SSP1/RCP2.6, GCM: GFDL Change

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_126_2050 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2041_2070/126/change_maps/afel_change_2041_2070_126_gfdl.tif"))
lu_126_2050 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2025.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_126_2050) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
```{r}
plot(sdm_126_2050)
plot(lu_126_2050)
```
#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_126_2050_reproj_as <- sdm_126_2050 %>% 
  project(crs(lu_126_2050), method = "near")

plot(sdm_126_2050_reproj_as)
```

#### Reclassify values of the SDM Change map
In original:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
Now:
Same, except reclassify 2 (no change, not suitable) as NA
```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_126_2050_reclass <- sdm_126_2050_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_126_2050_reclass))
```

### Land Use

#### Crop land use to africa
```{r}
lu_126_2050_af <- crop(lu_126_2050, sdm_126_2050_reproj_as)
plot(lu_126_2050_af)
```

#### Reclassify values of the year 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_126_2050 <- lu_126_2050_af
cropland_126_2050[cropland_126_2050 != 5] <- 0
cropland_126_2050[cropland_126_2050 == 5] <- 1
plot(cropland_126_2050)
```

#### Aggregate cropland

```{r}
cropland_126_2050_agg <- terra::aggregate(x = cropland_126_2050, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2050_agg)
```
#### Reclassify cropland into 3 categories

```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2050_factor <- cropland_126_2050_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2050_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_126_2050_resamp <- resample(sdm_126_2050_reclass, cropland_126_2050_factor, method = "near")

plot(as.factor(sdm_126_2050_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2055)
```{r}
af_sdm_change_ag_126_2050 <- as.factor(sdm_126_2050_resamp + cropland_126_2050_factor)
```

### Map and export final raster

####Map with colors
```{r}
sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(af_sdm_change_ag_126_2050, main = "SDM Change and Cropland in 2055
     SSP1 RCP2.6", type = "classes", col = sdmRYGscale)

```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_sdm_change_ag_126_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_sdm_change_ag_126_2050.tif"), overwrite = TRUE)
```




## Year: 2041-2070, Scenario: SSP5/RCP8.5, GCM: GFDL Change

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2050 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2041_2070/585/change_maps/afel_change_2041_2070_585_gfdl.tif"))
lu_585_2050 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2055.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_585_2050) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
```{r}
plot(sdm_585_2050)
plot(lu_585_2050)
```
#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_585_2050_reproj_as <- sdm_585_2050 %>% 
  project(crs(lu_585_2050), method = "near")

plot(sdm_585_2050_reproj_as)
```

#### Reclassify values of the SDM Change map
In original:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
Now:
Same, except reclassify 2 (no change, not suitable) as NA
```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_585_2050_reclass <- sdm_585_2050_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_585_2050_reclass))
```

### Land Use

#### Crop land use to africa
```{r}
lu_585_2050_af <- crop(lu_585_2050, sdm_585_2050_reproj_as)
plot(lu_585_2050_af)
```

#### Reclassify values of the year 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_585_2050 <- lu_585_2050_af
cropland_585_2050[cropland_585_2050 != 5] <- 0
cropland_585_2050[cropland_585_2050 == 5] <- 1
plot(cropland_585_2050)
```

#### Aggregate cropland

```{r}
cropland_585_2050_agg <- terra::aggregate(x = cropland_585_2050, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2050_agg)
```
#### Reclassify cropland into 3 categories

```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_585_2050_factor <- cropland_585_2050_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2050_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_585_2050_resamp <- resample(sdm_585_2050_reclass, cropland_585_2050_factor, method = "near")

plot(as.factor(sdm_585_2050_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP5/RCP8.5, 2055)
```{r}
af_sdm_change_ag_585_2050 <- as.factor(sdm_585_2050_resamp + cropland_585_2050_factor)
```
### Map and export final raster

#### Map with colors
```{r}
sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(af_sdm_change_ag_585_2050, main = "SDM Change and Cropland in 2055
     SSP5 RCP8.5", type = "classes", col = sdmRYGscale)
```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_sdm_change_ag_585_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_sdm_change_ag_585_2050.tif"), overwrite = TRUE)
```



## Year: 2071-2100, Scenario: SSP1/RCP2.6, GCM: GFDL Change

### Setup and read PROJECTED land use and SDM

#### Load in packages
```{r}
library(tidyverse)
library(terra)
library(raster)
```

#### Read in land use and SDM
```{r}
sdm_126_2080 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2071_2100/126/change_maps/afel_change_2071_2100_126_gfdl.tif"))
lu_126_2080 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2085.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_126_2080) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_126_2080)
plot(lu_126_2080)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_126_2080_reproj_as <- sdm_126_2080 %>% 
  project(crs(lu_126_2080), method = "near")

plot(sdm_126_2080_reproj_as)
```

#### Reclassify values of the SDM Change map
In original:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
Now:
Make 2 NA and move other values to tens place
```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_126_2080_reclass <- sdm_126_2080_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_126_2080_reclass))
```

### Land Use

#### Crop land use to africa
```{r}
lu_126_2080_af <- crop(lu_126_2080, sdm_126_2080_reproj_as)
plot(lu_126_2080_af)
```

#### Reclassify values of the year 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_126_2080 <- lu_126_2080_af
cropland_126_2080[cropland_126_2080 != 5] <- 0
cropland_126_2080[cropland_126_2080 == 5] <- 1
plot(cropland_126_2080)
```

#### Aggregate cropland

```{r}
cropland_126_2080_agg <- terra::aggregate(x = cropland_126_2080, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2080_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2080_factor <- cropland_126_2080_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2080_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_126_2080_resamp <- resample(sdm_126_2080_reclass, cropland_126_2080_factor, method = "near")

plot(as.factor(sdm_126_2080_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2085)
```{r}
af_sdm_change_ag_126_2080 <- as.factor(sdm_126_2080_resamp + cropland_126_2080_factor)

```

### Map and export final raster

#### Map with colors
```{r}
sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(af_sdm_change_ag_126_2080, main = "SDM Change and Cropland in 2085
     SSP1 RCP2.6", type = "classes", col = sdmRYGscale)
```


#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_sdm_change_ag_126_2080, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_sdm_change_ag_126_2080.tif"), overwrite = TRUE)
```





## Year: 2071-2100, Scenario: SSP5/RCP8.5, GCM: GFDL Change

###Setup and read PROJECTED land use and SDM

#### Load packages
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2080 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/LQ/2071_2100/585/change_maps/afel_change_2071_2100_585_gfdl.tif"))
lu_585_2080 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2085.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
```{r}
ext(sdm_585_2080) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them
```{r}
plot(sdm_585_2080)
plot(lu_585_2080)
```

#### Re-project the SDM to have the same CRS as the land use
```{r}
sdm_585_2080_reproj_as <- sdm_585_2080 %>% 
  project(crs(lu_585_2080), method = "near")

plot(sdm_585_2080_reproj_as)
```

#### Reclassify values of the SDM Change map
In original:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability
Now:
Make 2 NA and move other values to tens place
```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_585_2080_reclass <- sdm_585_2080_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_585_2080_reclass))
```

### Land Use

#### Crop land use to africa
```{r}
lu_585_2080_af <- crop(lu_585_2080, sdm_585_2080_reproj_as)
plot(lu_585_2080_af)
```

#### Reclassify values of the year 2085 for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
cropland_585_2080 <- lu_585_2080_af
cropland_585_2080[cropland_585_2080 != 5] <- 0
cropland_585_2080[cropland_585_2080 == 5] <- 1
plot(cropland_585_2080)
```

#### Aggregate cropland

```{r}
cropland_585_2080_agg <- terra::aggregate(x = cropland_585_2080, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2080_agg)
```
#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_585_2080_factor <- cropland_585_2080_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2080_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution

```{r}
sdm_585_2080_resamp <- resample(sdm_585_2080_reclass, cropland_585_2080_factor, method = "near")

plot(as.factor(sdm_585_2080_resamp))
```

#### Raster math - Cropland change vs SDM change (SSP5/RCP8.5, 2055)
```{r}
af_sdm_change_ag_585_2080 <- as.factor(sdm_585_2080_resamp + cropland_585_2080_factor)
```

### Map and export final raster

#### Map with Colors
```{r}
sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(af_sdm_change_ag_585_2080, main = "SDM Change and Cropland in 2085
     SSP5 RCP8.5", type = "classes", col = sdmRYGscale)
```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(af_sdm_change_ag_585_2080, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/afel_sdm_change_ag_585_2080.tif"), overwrite = TRUE)
```





