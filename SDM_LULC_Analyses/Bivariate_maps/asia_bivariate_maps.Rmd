---
title: "Asia Bivariate Maps"
author: "Taylor Lockmann, Chris Kracha"
date: "2022-07-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Load in packages
library(tidyverse)
library(terra)
library(raster)

HWC_data <- "G:/.shortcut-targets-by-id/1YB-Hz3L-kWyiZMg2UM89GQkvqXyZUW1H/HWC_data"
```


# BASELINE/HISTORIC MAPPING

### Read in the baseline land use and SDM

```{r}
sdm <- rast(paste0(HWC_data, "/Wallace SDM Rasters/asia/1981_2010/indicus_historic.tif"))
lu <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/global_LULC_2015.tif"))
```


### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)
              
```{r}
ext(sdm) <- c(65.8581934609999990,
              131.0665265334999958,
              -12.2168058669999979,
              35.8248606080000016)
```

#### Re-project SDM to have same CRS and extent as the LU layer

```{r}
sdm_reproj_as <- sdm %>% 
  project(crs(lu))

plot(sdm_reproj_as)
```


#### Reclassify SDM

```{r}
baseline_sdm <- sdm_reproj_as
baseline_sdm[baseline_sdm >= 0 & baseline_sdm < 0.33] <- 10
baseline_sdm[baseline_sdm >= 0.33 & baseline_sdm < 0.66] <- 20
baseline_sdm[baseline_sdm >=0.66 & baseline_sdm <= 1] <- 30

plot(baseline_sdm)
```

### Land Use

#### Crop land use to asia
```{r}
lu_as <- lu %>% crop(sdm_reproj_as)
plot(lu_as)
```

#### Reclassify values of the baseline year for cropland
We want cropland (category 5) to be 1, everything else to be 0
```{r}
baseline_cropland <- lu_as
baseline_cropland[baseline_cropland != 5] <- 0
baseline_cropland[baseline_cropland == 5] <- 1
plot(baseline_cropland)
```

#### Aggregate cropland 
aggregate by factor of 10 (1km -> 10km)
```{r}
baseline_cropland_agg <- terra::aggregate(baseline_cropland, fact = 10, fun = mean, na.rm = TRUE)

plot(baseline_cropland_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

base_cropland_factor <- baseline_cropland_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(base_cropland_factor)
```

### Add SDM and Cropland

#### Make both of the rasters have the same resolution
```{r}
base_sdm <- resample(baseline_sdm, base_cropland_factor, method = "near")
plot(base_sdm)
```

#### Add the two layers together
```{r}
baseline_bivariate_indomalaya <- (base_sdm + base_cropland_factor)

baselineScale <- c("#E6E6FA", "#BC7C8F", "#AE3A4E", "#89A1C8", "#806A8A", "#77324C", "#4885C1", "#435786", "#3F2949")

plot(as.factor(baseline_bivariate_indomalaya), main = "Baseline SDM and Cropland", type = "classes", col = baselineScale)

```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(baseline_bivariate_indomalaya, "G:/.shortcut-targets-by-id/1YB-Hz3L-kWyiZMg2UM89GQkvqXyZUW1H/HWC_data/Geospatial Data/bivariate_outputs/asel_sdm_change_ag_baseline.tif", overwrite = TRUE)
```


# FUTURE PROJECTIONS

## Year: 2011-2040, Scenario: SSP1/RCP2.6, GCM: GFDL
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_126_2020 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/asia/2011_2040/change_maps/change_2011_2040_126_gfdl.tif"))
lu_126_2020 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2025.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)

```{r}
ext(sdm_126_2020) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them

FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability

```{r}
plot(sdm_126_2020)
plot(lu_126_2020)
```

####  Re-project SDM to have same CRS as the LU layer
```{r}
sdm_126_2020_reproj_as <- sdm_126_2020 %>% 
  project(crs(lu_126_2020), method = "near")

plot(sdm_126_2020_reproj_as)
```

#### Reclassify SDM change to tens place, and remove 2

```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_126_2020_reclass <- sdm_126_2020_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_126_2020_reclass))
```

### Land Use

#### Crop land use to asia
```{r}
lu_126_2020_as <- lu_126_2020 %>% crop(sdm_126_2020_reclass)
plot(lu_126_2020_as)
```

#### Reclassify values in 2025 for cropland
We want cropland (category 5) to be 1, everything else to be 0

```{r}
cropland_126_2020 <- lu_126_2020_as
cropland_126_2020[cropland_126_2020 != 5] <- 0
cropland_126_2020[cropland_126_2020 == 5] <- 1
plot(cropland_126_2020)
```

#### Aggregate cropland 
factor <- ceiling(res(sdm)[1]/res(chen)[1])
```{r}
cropland_126_2020_agg <- terra::aggregate(cropland_126_2020, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2020_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2020_factor <- cropland_126_2020_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2020_factor)
```

### Add SDM and Cropland

#### Make both of the rasters have the same resolution
```{r}
sdm_126_2020_resamp <- resample(sdm_126_2020_reclass, cropland_126_2020_factor, method = "near")

plot(sdm_126_2020_resamp)
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2025)
```{r}
sdm_change_ag_126_2020 <- as.factor(sdm_126_2020_resamp + cropland_126_2020_factor)

sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(sdm_change_ag_126_2020, main = "SDM Change and Cropland in 2025
     SSP1 RCP2.6", type = "classes", col = sdmRYGscale)

```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(sdm_change_ag_126_2020, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/asel_sdm_change_ag_126_2020.tif"), overwrite = TRUE)
```



## Year: 2011-2040, Scenario: SSP5/RCP8.5, GCM: GFDL

```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2020 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/asia/2011_2040/change_maps/change_2011_2040_585_gfdl.tif"))
lu_585_2020 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2025.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)

```{r}
ext(sdm_585_2020) <- c(65.8581934609999990,
                       131.0665265334999958,
                       -12.2168058669999979,
                       35.8248606080000016)
```


#### Plot to look at them

FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability

```{r}
plot(sdm_585_2020)
plot(lu_585_2020)
```


#### Re-project SDM to have same CRS and extent as the LU layer

```{r}
sdm_585_2020_reproj_as <- sdm_585_2020 %>% 
  project(crs(lu), method = "near")

plot(sdm_585_2020_reproj_as)
```

#### Reclassify SDM change to tens place, and remove 2

```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_585_2020_reclass <- sdm_585_2020_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_585_2020_reclass))
```

### Land Use

#### Crop land use to asia

```{r}
lu_126_2020_as <- lu_126_2020 %>% crop(sdm_585_2020_reclass)
plot(lu_126_2020_as)
```

#### Reclassify values in 2025 for cropland
We want cropland (category 5) to be 1, everything else to be 0

```{r}
cropland_585_2020 <- lu_126_2020_as
cropland_585_2020[cropland_585_2020 != 5] <- 0
cropland_585_2020[cropland_585_2020 == 5] <- 1
plot(cropland_585_2020)
```

#### Aggregate cropland 
factor <- ceiling(res(sdm)[1]/res(chen)[1])

```{r}
cropland_585_2020_agg <- terra::aggregate(cropland_585_2020, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2020_agg)
```

#### Reclassify cropland into 3 categories

```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_585_2020_factor <- cropland_585_2020_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2020_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution
```{r}
sdm_585_2020_resamp <- resample(sdm_585_2020_reclass, cropland_585_2020_factor, method = "near")
plot(sdm_585_2020_resamp)
```

#### Raster math - Cropland change vs SDM change (SSP5/RCP8.5, 2025)
```{r}
sdm_change_ag_585_2020 <- as.factor(sdm_585_2020_resamp + cropland_585_2020_factor)

sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(sdm_change_ag_585_2020, main = "SDM Change and Cropland in 2055
     SSP5 RCP8.5", type = "classes", col = sdmRYGscale)

```

#### Write the file to a .tif to export to QGIS

```{r}
writeRaster(sdm_change_ag_585_2020, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/asel_sdm_change_ag_585_2020.tif"), overwrite = TRUE)
```




## Year: 2041-2070, Scenario: SSP1/RCP2.6, GCM: GFDL
```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_126_2050 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/asia/2041_2070/change_maps/change_2041_2070_126_gfdl.tif"))
lu_126_2050 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2055.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)

```{r}
ext(sdm_126_2050) <- c(-25.3584728410000011,
              77.5998600799999849,
              -40.4084724209999990,
              26.3831939790000014)
```


#### Plot to look at them

FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability

```{r}
plot(sdm_126_2050)
plot(lu_126_2050)
```

####  Re-project SDM to have same CRS as the LU layer
```{r}
sdm_126_2050_reproj_as <- sdm_126_2050 %>% 
  project(crs(lu), method = "near")

plot(sdm_126_2050_reproj_as)
```

#### Reclassify SDM change to tens place, and remove 2

```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_126_2050_reclass <- sdm_126_2050_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_126_2050_reclass))
```

### Land Use

#### Crop land use to asia
```{r}
lu_as <- lu %>% crop(sdm_126_2050_reclass)
plot(lu_as)
```

#### Reclassify values in 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0

```{r}
cropland_126_2050 <- lu_as
cropland_126_2050[cropland_126_2050 != 5] <- 0
cropland_126_2050[cropland_126_2050 == 5] <- 1
plot(cropland_126_2050)
```

#### Aggregate cropland 
```{r}
cropland_126_2050_agg <- terra::aggregate(cropland_126_2050, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2050_agg)
```

#### Reclassify cropland into 3 categories
```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2050_factor <- cropland_126_2050_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2050_factor)
```

### Add SDM and Cropland

#### Make both of the rasters have the same resolution
```{r}
sdm_126_2050_resamp <- resample(sdm_126_2050_reclass, cropland_126_2050_factor, method = "near")

plot(sdm_126_2050_resamp)
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2055)
```{r}
sdm_change_ag_126_2050 <- as.factor(sdm_126_2050_resamp + cropland_126_2050_factor)

sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(sdm_change_ag_126_2050, main = "SDM Change and Cropland in 2055
     SSP1 RCP2.6", type = "classes", col = sdmRYGscale)

```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(sdm_change_ag_126_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/asel_sdm_change_ag_126_2050.tif"), overwrite = TRUE)
```


### Map of cropland change (UNUSED)
future crops - present crops
```{r}
base_cropland_resamp <- resample(baseline_cropland_agg, 
                                 cropland_126_2050_agg, 
                                 method = "near")

plot(base_cropland_resamp)

p_diff <- 0.01   # Enter max difference 
                 # in % allowed for "no change" category
cropDiverge <- rbind(c(-1, -p_diff,-1), 
                     c(-p_diff, p_diff, 0), 
                     c(p_diff, 1, 1))

crops_change_126_2050 <- (cropland_126_2050_agg - base_cropland_resamp) %>%
  classify(cropDiverge)

plot(crops_change_126_2050)



#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2055)

bivariate_change_126_2050 <- (sdm_126_2050_resamp + crops_change_126_2050)

plot(bivariate_change_126_2050, main = "Cropland Change")
```

#### Write the file to a .tif to export to QGIS

```{r}
writeRaster(bivariate_change_126_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/asel_sdm_change_ag_126_2050.tif"), overwrite = TRUE)
```







## Year: 2041-2070, Scenario: SSP5/RCP8.5, GCM: GFDL

```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2050 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/asia/2041_2070/change_maps/change_2041_2070_585_gfdl.tif"))
lu_585_2050 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2055.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)

```{r}
ext(sdm_585_2050) <- c(65.8581934609999990,
                       131.0665265334999958,
                       -12.2168058669999979,
                       35.8248606080000016)
```


#### Plot to look at them

FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability

```{r}
plot(sdm_585_2050)
plot(lu_585_2050)
```


#### Re-project SDM to have same CRS and extent as the LU layer

```{r}
sdm_585_2050_reproj_as <- sdm_585_2050 %>% 
  project(crs(lu), method = "near")

plot(sdm_585_2050_reproj_as)
```

#### Reclassify SDM change to tens place, and remove 2

```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_585_2050_reclass <- sdm_585_2050_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_585_2050_reclass))
```

### Land Use

#### Crop land use to asia

```{r}
lu_as <- lu %>% crop(sdm_585_2050_reclass)
plot(lu_as)
```

#### Reclassify values in 2055 for cropland
We want cropland (category 5) to be 1, everything else to be 0

```{r}
cropland_585_2050 <- lu_as
cropland_585_2050[cropland_585_2050 != 5] <- 0
cropland_585_2050[cropland_585_2050 == 5] <- 1
plot(cropland_585_2050)
```

#### Aggregate cropland 
factor <- ceiling(res(sdm)[1]/res(chen)[1])

```{r}
cropland_585_2050_agg <- terra::aggregate(cropland_585_2050, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2050_agg)
```

#### Reclassify cropland into 3 categories

```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_585_2050_factor <- cropland_585_2050_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2050_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution
```{r}
sdm_585_2050_resamp <- resample(sdm_585_2050_reclass, cropland_585_2050_factor, method = "near")
plot(sdm_585_2050_resamp)
```

#### Raster math - Cropland change vs SDM change (SSP5/RCP8.5, 2055)
```{r}
sdm_change_ag_585_2050 <- as.factor(sdm_585_2050_resamp + cropland_585_2050_factor)

sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(sdm_change_ag_585_2050, main = "SDM Change and Cropland in 2055
     SSP5 RCP8.5", type = "classes", col = sdmRYGscale)

```

#### Write the file to a .tif to export to QGIS

```{r}
writeRaster(sdm_change_ag_585_2050, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/asel_sdm_change_ag_585_2050.tif"), overwrite = TRUE)
```



## Year: 2071-2100, Scenario: SSP1/RCP2.6, GCM: GFDL

```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```

#### Read in the PROJECTED land use and SDM
```{r}
sdm_126_2080 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/asia/2071_2100/change_maps/change_2071_2100_126_gfdl.tif"))
lu_126_2080 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP1_RCP26/global_SSP1_RCP26_2085.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)

```{r}
ext(sdm_126_2080) <- c(-25.3584728410000011,
                       77.5998600799999849,
                       -40.4084724209999990,
                       26.3831939790000014)
```


#### Plot to look at them

FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability

```{r}
plot(sdm_126_2080)
plot(lu_126_2080)
```


#### Re-project SDM to have same CRS and extent as the LU layer

```{r}
sdm_126_2080_reproj_as <- sdm_126_2080 %>% 
  project(crs(lu), method = "near")

plot(sdm_126_2080_reproj_as)
```

#### Reclassify SDM change to tens place, and remove 2

```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_126_2080_reclass <- sdm_126_2080_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_126_2080_reclass))
```

### Land Use

#### Crop land use to asia

```{r}
lu_as <- lu %>% crop(sdm_126_2080_reclass)
plot(lu_as)
```

#### Reclassify values in 2085 for cropland
We want cropland (category 5) to be 1, everything else to be 0

```{r}
cropland_126_2080 <- lu_as
cropland_126_2080[cropland_126_2080 != 5] <- 0
cropland_126_2080[cropland_126_2080 == 5] <- 1
plot(cropland_126_2080)
```

#### Aggregate cropland 
```{r}
cropland_126_2080_agg <- terra::aggregate(cropland_126_2080, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_126_2080_agg)
```

#### Reclassify cropland into 3 categories

```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_126_2080_factor <- cropland_126_2080_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_126_2080_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution
```{r}
sdm_126_2080_resamp <- resample(sdm_126_2080_reclass, cropland_126_2080_factor, method = "near")
plot(sdm_126_2080_resamp)
```

#### Raster math - Cropland change vs SDM change (SSP1/RCP2.6, 2085)
```{r}
sdm_change_ag_126_2080 <- as.factor(sdm_126_2080_resamp + cropland_126_2080_factor)

sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(sdm_change_ag_126_2080, main = "SDM Change and Cropland in 2085
     SSP1 RCP2.5", type = "classes", col = sdmRYGscale)
```

#### Write the file to a .tif to export to QGIS
```{r}
writeRaster(sdm_change_ag_126_2080, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/asel_sdm_change_ag_126_2080.tif"), overwrite = TRUE)
```

## Year: 2071-2100, Scenario: SSP5/RCP8.5, GCM: GFDL

```{r}
# Load in packages
library(tidyverse)
library(terra)
library(raster)
```


#### Read in the PROJECTED land use and SDM
```{r}
sdm_585_2080 <- rast(paste0(HWC_data, "/Wallace SDM Rasters/asia/2071_2100/change_maps/change_2071_2100_585_gfdl.tif"))
lu_585_2080 <- rast(paste0(HWC_data, "/Geospatial Data/Chen_LULC_data/SSP5_RCP85/global_SSP5_RCP85_2085.tif"))
```

### SDM

#### SDM raster does not have an extent, so we're going to assign it (found by importing to QGIS)

```{r}
ext(sdm_585_2080) <- c(65.8581934609999990,
                       131.0665265334999958,
                       -12.2168058669999979,
                       35.8248606080000016)
```


#### Plot to look at them

FOR SDM:
1 - decreasing suitability
2 - no change, not suitable
3 - no change, suitable
4 - increasing suitability

```{r}
plot(sdm_585_2080)
plot(lu_585_2080)
```


#### Re-project SDM to have same CRS and extent as the LU layer

```{r}
sdm_585_2080_reproj_as <- sdm_585_2080 %>% 
  project(crs(lu), method = "near")

plot(sdm_585_2080_reproj_as)
```

#### Reclassify SDM change to tens place, and remove 2

```{r}
sdmChange3categories <- rbind(c(1,10), c(2,NA), c(3,30), c(4,40))

sdm_585_2080_reclass <- sdm_585_2080_reproj_as %>%
  classify(sdmChange3categories)

plot(as.factor(sdm_585_2080_reclass))
```

### Land Use

#### Crop land use to asia

```{r}
lu_as <- lu %>% crop(sdm_585_2080_reclass)
plot(lu_as)
```

#### Reclassify values in 2085 for cropland
We want cropland (category 5) to be 1, everything else to be 0

```{r}
cropland_585_2080 <- lu_as
cropland_585_2080[cropland_585_2080 != 5] <- 0
cropland_585_2080[cropland_585_2080 == 5] <- 1
plot(cropland_585_2080)
```

#### Aggregate cropland 
```{r}
cropland_585_2080_agg <- terra::aggregate(cropland_585_2080, fact = 10, fun = mean, na.rm = TRUE)

plot(cropland_585_2080_agg)
```

#### Reclassify cropland into 3 categories

```{r}
cropland3categories <- rbind(c(0,0,0),
                        c(0,0.5,1),
                        c(0.5,1,2))

cropland_585_2080_factor <- cropland_585_2080_agg %>% 
  classify(cropland3categories, include.lowest = FALSE)

plot(cropland_585_2080_factor)
```

### Add SDM and cropland

#### Make both of the rasters have the same resolution
```{r}
sdm_585_2080_resamp <- resample(sdm_585_2080_reclass, cropland_585_2080_factor, method = "near")
plot(sdm_585_2080_resamp)
```

#### Raster math - Cropland change vs SDM change (SSP5/RCP8.5, 2055)
```{r}
sdm_change_ag_585_2080 <- as.factor(sdm_585_2080_resamp + cropland_585_2080_factor)

sdmRYGscale <- c("pink", "tomato", "maroon", "#FFFF99", "goldenrod1", "dark orange", "pale green", "green", "dark green")

plot(sdm_change_ag_585_2080, main = "SDM Change and Cropland in 2085
     SSP5 RCP8.5", type = "classes", col = sdmRYGscale)

```

#### Write the file to a .tif to export to QGIS

```{r}
writeRaster(sdm_change_ag_585_2080, paste0(HWC_data, "/Geospatial Data/bivariate_outputs/asel_sdm_change_ag_585_2080.tif"), overwrite = TRUE)
```



